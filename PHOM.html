<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHOM - Drug Discovery Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="landingPage" class="page active">
        <div class="note">
            <p>·ç® UPDATE News | Launching in almost 90 days</p>
            <a href="https://t.me/amrqhz">Contact with us</a>
        </div>

        <header>
            <div class="logo" onclick="location.reload()">PHOM</div>
            <nav id="navMenu">
                <a href="#features">Product</a>
                <a href="#about">About</a>
                <a href="DOCS.html">Docs</a>
            </nav>
            <div class="btnheader">
                <button class="btn-header" id="signInBtn">Sign In</button>
                <button class="btn-header2" id="signUpBtn">Sign Up</button>
            </div>
            <div class="hamburger" id="hamburger">
                <span></span><span></span><span></span>
            </div>
        </header>

        <section class="hero">
            <div class="hero-content">
                <small>Welcome to the PHOM</small>
                <h1>The Infrastructure for Drug Discovery</h1>
                <div class="hero-info">
                    <span>üî¨ Research Lab</span>
                    <span>üè• Bio-Analytics</span>
                    <span>üìä Data Science</span>
                </div>
                <div class="hero-buttons">
                    <button class="btn-primary" id="getStartedBtn">Get Started</button>
                    <button class="btn-secondary">Watch Demo</button>
                </div>
            </div>
        </section>

        <section class="focus-section">
            <h2 class="section-title" id="features">You focus on the science. We handle the rest.</h2>
            <div class="feature-boxes">
                <div class="feature-box">
                    <h3>Data Informatics</h3>
                    <p>Comprehensive molecular databases and advanced search for drug discovery.</p>
                </div>
                <div class="feature-box">
                    <h3>Multi-collaboration</h3>
                    <p>Share and collaborate on research data with real-time updates.</p>
                </div>
                <div class="feature-box">
                    <h3>Protocol management</h3>
                    <p>Standardize and manage experimental protocols effectively.</p>
                </div>
            </div>
        </section>
    </div>

    <div id="authModal" class="modal-overlay">
        <div class="modal">
            <h2 id="modalTitle">Sign In</h2>
            <p class="modal-subtitle" id="modalSubtitle">Join PHOM and start your research</p>
            <div id="errorMessage" class="error-message"></div>
            <form id="authForm">
                <div id="signUpFields"></div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="you@example.com" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="At least 6 characters" required>
                </div>
                <button type="submit" class="btn-submit">Sign In</button>
            </form>
            <div class="modal-footer">
                <span id="footerText">Don't have an account? <a id="toggleAuth">Sign Up</a></span>
            </div>
        </div>
        <button class="modal-close" id="modalClose">&times;</button>
    </div>

    <div id="dialogOverlay" class="dialog-overlay">
        <div class="dialog-box">
            <div class="dialog-header">
                <h3 id="dialogTitle">New Chat</h3>
                <p id="dialogSubtitle">Enter a name for your new chat</p>
            </div>
            <input type="text" id="dialogInput" class="dialog-input" placeholder="e.g., Kinase inhibitor research...">
            <div class="dialog-buttons">
                <button class="dialog-btn dialog-btn-cancel" id="dialogCancel">Cancel</button>
                <button class="dialog-btn dialog-btn-confirm" id="dialogConfirm">Create</button>
            </div>
        </div>
    </div>

    <div id="dashboardPage" class="page">
        <div class="dashboard-wrapper">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-top">
                    <div class="sidebar-logo">
                        <div class="sidebar-logo-main"><a href="PHOM.html">PHOM</a></div>
                        <div class="sidebar-logo-subtitle">Pharmacy Oriented Models</div> 
                    </div>

                    <ul class="sidebar-menu">
                        <li><a href="#" class="sidebar-link active" data-page="home">Home</a></li>
                        <!-- <li><a href="#" class="sidebar-link" data-page="lab">Lab</a></li> -->
                        <li><a href="#" class="sidebar-header sidebar-link" data-page="lab">
                            Lab <span class="dropdown-arrow">‚ñº</span></a>
                        </li>
                        <div class="submenu-li">
                            <li><a href="#" class="sidebar-link submenu-item" data-page="design">Design</a></li>
                            <li><a href="#" class="sidebar-link submenu-item" data-page="structure-prediction">Structure Prediction</a></li>
                            <li><a href="#" class="sidebar-link submenu-item" data-page="molecular-docking">Molecular Docking</a></li>
                            <li><a href="#" class="sidebar-link submenu-item" data-page="denovo">DeNovo</a></li>    
                        </div>

                        <li><a href="#" class="sidebar-link" data-page="files">Files</a></li>
                        <li><a href="#" class="sidebar-link" data-page="chatbot">Chatbot</a><span class="soon">soon</span></li>
                        <li><a href="#" class="sidebar-link" data-page="wet-lab">Wet Lab</a><span class="soon">soon</span></li>
                        <li><a href="#" class="sidebar-link" data-page="support">Support</a><span class="soon">soon</span></li>
                        <li><a href="#" class="sidebar-link" data-page="settings">Setting</a><span class="soon">soon</span></li>

                    </ul>


                    <div class="sidebar-divider"></div>

                    <div class="section-group">
                        <div class="section-header" id="toggleChats">
                            <div>
                                <span>Recent chats</span>
                                <span class="section-count" id="chatCount">6 days ago  23 chat</span>
                            </div>
                            <button class="sidebar-btn sidebar-btn-new" id="newChatBtn"></button>
                            <span class="dropdown-icon open">‚ñº</span>
                        </div>
                        <div class="section-items" id="chatsList"></div>
                    </div>

                    <div class="sidebar-divider"></div>
                    <div class="section-group">
                        <div class="section-header" id="toggleProjects">
                            <div>
                                <span>Projects</span>
                                <span class="section-count" id="projectCount">2 projects</span>
                            </div>
                            <button class="sidebar-btn sidebar-btn-new" id="newProjectBtn"></button>
                            <span class="dropdown-icon open">‚ñº</span>
                        </div>
                        <div class="section-items" id="projectsList"></div>
                    </div>
                </div>

                <div class="sidebar-user">
                    <div class="user-avatar-large" id="userAvatarSidebar">A</div>
                    <div class="user-info">
                        <div class="user-name" id="userNameSidebar">ARUMS</div>
                        <div class="user-email" id="userEmailSidebar">admin@gmail.com</div>
                    </div>
                </div>
            </aside>

            <div class="main-content-wrapper">
                <div id="homeContent" class="content-section active">                   
                    <div class="sidebar-section">
                        <h2 id="homeGreeting">Hello</h2>
                        <p>Computational chemistry tools</p>
                        <h3 style="margin-top: 5rem;">THIS IS YOUR ASSISTENT IN DRUG DISCOVERY JOURNEY</h3>
                        <p style="font-size: 0.85rem; margin-top: 1rem; color: #999;">
                            let's have some fun and learn about this amazing Platform:<br>
                            1. you can use the lab for your PK/PD which contains docking, MD and DFT and also some other tools for visualization.<br>
                            2.
                            <!-- üß™ Molecular docking<br>
                            ‚öóÔ∏è Property prediction<br>
                            üìä Structure analysis -->
                        </p>
                        
                    </div>
                    <footer style="text-align: center; margin-top: 18rem;color: #bdbdbd;">PHOM <br><span>Pharmacy Oriented Models</span></footer>
                </div>

                <div id="chatbotContent" class="content-section ">
                    <div class="chat-interface">
                        <div class="chat-main">
                            <div class="chat-messages-area" id="chatMessagesArea">
                                <div class="chat-message-wrapper ai">
                                    <div class="chat-message ai">Let's discover this world together...</div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-section">
                            <div class="chat-input-area">
                                <div class="chat-input-group">
                                    <div class="chat-input-wrapper">
                                        <textarea id="chatInput" placeholder="Design a kinase inhibitor with high..."></textarea>
                                    </div>
                                    <div class="chat-input-buttons">
                                        <button class="chat-action-btn">üìé</button>
                                        <button class="chat-send-btn" id="chatSendBtn">‚Üë</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="filesContent" class="content-section">
                    <div class="leftside" id="filesLeftSide">
                        <div class="files-container">
                            <div class="files-header">
                                <h2>üìÅ Research Files</h2>
                                <p style="color: #999; font-size: 0.9rem;">Upload and manage your research datasets</p>
                            </div>

                            <div class="files-wrapper" id="filesWrapper">
                                <div class="files-list-section" id="filesListSection">
                                    <div id="filesList" class="files-grid"></div>
                                </div>
                            </div>

                            <div class="files-upload-section">
                                <div class="upload-area" id="uploadArea">
                                    <div class="upload-icon">üì§</div>
                                    <div class="upload-text"><strong>Click to upload</strong> or drag and drop</div>
                                </div>
                                <input type="file" id="fileInput" multiple style="display: none;">

                            </div>
                        </div>
                    </div>

                    <div class="rightside" id="filesRightSide">
                        <div class="files-preview-section" id="filesPreviewSection">
                            <div class="files-preview-header">
                                <div class="files-preview-title" id="previewTitle">File Preview</div>
                                <button class="preview-close-btn" id="previewCloseBtn">√ó</button>
                            </div>
                            <div class="files-preview-content" id="previewContent"></div>
                        </div>
                    </div>
                </div>

                <div id="labContent" class="content-section">
                    <div class="sidebar-section">
                        <h2>üî¨ Lab Module</h2>
                        <p>Computational chemistry tools</p>
                        <p style="font-size: 0.85rem; margin-top: 1rem; color: #999;">
                            üß™ Molecular docking<br>
                            ‚öóÔ∏è Property prediction<br>
                            üìä Structure analysis
                        </p>

                        <div class="lab-modules-container">
                            
                            <div class="modules-grid">
                                <!-- Module 1: PK AND PD -->
                                <div class="module-card" data-module="pk-pd">
                                    <div class="module-header">
                                        <div class="module-icon"></div>
                                        <span class="expand-icon"></span>
                                    </div>
                                    <div class="module-title">PK&PD</div>
                                    <div class="module-description">Pharmacokinetics & Pharmacodynamics</div>
                                    <div class="submodules-list">
                                        <div class="submodule-item">Docking</div>
                                        <div class="submodule-item">‚öôÔ∏è Molecular Dynamics (MD)</div>
                                        <div class="submodule-item"> DFT Analysis</div>
                                        <div class="submodule-item"> Visualization & Export</div>
                                    </div>
                                </div>

                                <!-- Module 2: Formulation -->
                                <div class="module-card" data-module="formulation">
                                    <div class="module-header">
                                        <div class="module-icon"></div>
                                        <span class="expand-icon"></span>
                                    </div>
                                    <div class="module-title">Formulation</div>
                                    <div class="module-description">Drug Formulation & Synthesis</div>
                                    <div class="submodules-list">
                                        <div class="submodule-item">Metabolomic Analysis</div>
                                        <div class="submodule-item">Synthesis Yield Prediction</div>
                                        <div class="submodule-item">Experiment Selection</div>
                                    </div>
                                </div>

                                <!-- Module 3: Target Identification -->
                                <div class="module-card" data-module="target-id">
                                    <div class="module-header">
                                        <div class="module-icon"></div>
                                        <span class="expand-icon"></span>
                                    </div>
                                    <div class="module-title">Target Identification</div>
                                    <div class="module-description">Identify drug targets for design</div>
                                    <div class="submodules-list">
                                        <div class="submodule-item">Disease Target Search</div>
                                        <div class="submodule-item">Target Validation</div>
                                        <div class="submodule-item">Target Ranking</div>
                                    </div>
                                </div>

                                <!-- Module 4: In-Silico Physiology -->
                                <div class="module-card" data-module="insilico-physiology">
                                    <div class="module-header">
                                        <div class="module-icon"></div>
                                        <span class="expand-icon"></span>
                                    </div>
                                    <div class="module-title">In-Silico Physiology</div>
                                    <div class="module-description">Animal Modeling & Simulation</div>
                                    <div class="submodules-list">
                                        <div class="submodule-item">Rodent Models</div>
                                        <div class="submodule-item">Mammal Simulation</div>
                                        <div class="submodule-item">Bioavailability Prediction</div>
                                    </div>
                                </div>

                                <!-- Module 5: In-Silico Clinical -->
                                <div class="module-card" data-module="insilico-clinical">
                                    <div class="module-header">
                                        <div class="module-icon"></div>
                                        <span class="expand-icon"></span>
                                    </div>
                                    <div class="module-title">In-Silico Clinical</div>
                                    <div class="module-description">Patient-Specific Treatment</div>
                                    <div class="submodules-list">
                                        <div class="submodule-item">Combination Therapy</div>
                                        <div class="submodule-item">Best Drug Selection</div>
                                        <div class="submodule-item">Dosing Based on Patient Status</div>
                                    </div>
                                </div>

                                <!-- Module 6: Pharmacogenetics -->
                                <div class="module-card" data-module="pharmacogenetics">
                                    <div class="module-header">
                                        <div class="module-icon"></div>
                                        <span class="expand-icon"></span>
                                    </div>
                                    <div class="module-title">Pharmacogenetics</div>
                                    <div class="module-description">Genetic Drug Response Analysis</div>
                                    <div class="submodules-list">
                                        <div class="submodule-item">üî¨ Genotype Analysis</div>
                                        <div class="submodule-item">Phenotype Prediction</div>
                                        <div class="submodule-item">Drug-Gene Interaction</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="design" class="content-section">
                    <div class="chat-placeholder">
                        <div class="sidebar-section">
                            <h2>Design new molecule here together</h2>
                        </div>
                    </div>
                </div>
                <div id="structure-prediction" class="content-section">
                    <div class="chat-placeholder">
                        <div class="sidebar-section">
                            <h2>Predict new structure with our webserver</h2>
                        </div>
                    </div>
                </div>
                <div id="molecular-docking" class="content-section">
                    <div class="chat-placeholder">
                        <div class="sidebar-section">
                            <h2>Dock your ligand with new receptors with our webserver</h2>
                        </div>
                    </div>
                </div>
                <div id="denovo" class="content-section">
                    <div class="chat-placeholder">
                        <div class="sidebar-section">
                            <h2>Design new molecule and proteins</h2>
                        </div>
                    </div>
                </div>
                

                <div id="wetLabContent" class="content-section">
                    <div class="chat-placeholder">         
                        <div class="sidebar-section">
                            <h2>üß¨ Wet Lab</h2>
                            <p>Physical lab management</p>
                            <p style="font-size: 0.85rem; margin-top: 1rem; color: #999;">
                                üìã Experiment notebooks<br>
                                üî¨ Equipment tracking<br>
                                üìä Results management
                            </p>
                         </div>
                    </div>
                </div>
                <div id="supportContent" class="content-section">
                    <div class="chat-placeholder">
                        <div class="sidebar-section">
                            <h2>üí¨ Support</h2>
                            <p>Help and support</p>
                            <p style="font-size: 0.85rem; margin-top: 1rem; color: #999;">
                                üìß Email support<br>
                                üí¨ Live chat<br>
                                üìö Knowledge base
                            </p>
                        </div>
                    </div>

                </div>

                <div id="settingsContent" class="content-section">
                    <div class="chat-placeholder">
                        <div class="sidebar-section">
                            <h2 style="text-align: center; margin-bottom: 2rem;">‚öôÔ∏è Settings</h2>
                            <div style="width: 100%; max-width: 500px; text-align: left;">

                                <div class="profile">
                                    <h2>Profile</h2>
                                    <div class="form-group">
                                        <label>Full Name</label>
                                        <input type="text" id="settingsName" value="Amir">
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" id="settingsEmail" value="admin@gmail.com" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>Academic Status</label>
                                        <select id="settingsAcademicStatus" style="padding: 0.5rem;"">
                                            <option value="Student">Student</option>
                                            <option value="Researcher">Researcher</option>
                                            <option value="Professor">Professor</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                    
                                    <div class="form-group">
                                        <label>Department / Lab</label>
                                        <input type="text" id="settingsDepartment" placeholder="e.g., Pharmacy Lab">
                                    </div>
                    
                                    <div class="form-group">
                                        <label>Role in Lab / Project</label>
                                        <input type="text" id="settingsRole" placeholder="e.g., Team Lead">
                                    </div>
                    
                                    <div class="form-group">
                                        <label>Phone Number</label>
                                        <input type="tel" id="settingsPhone" placeholder="e.g., +98 912 345 6789">
                                    </div>
                    
                                    <div class="form-group">
                                        <label>Bio</label>
                                        <textarea id="settingsBio" rows="3" placeholder="Short description about yourself"></textarea>
                                    </div>
                    
                                    
                                    <button class="btn-primary" id="logoutBtn" style="width: 100%; margin-top: 1rem;">Logout</button>
                                    <button class="btn-primary" id="saveBtn" style="width: 100%; margin-top: 1rem;">Save</button>
                    
        
                                </div>
                            </div>
                            <div class="setting">
                                <button class="btn-primary" id="themechanger" style="width: 100%; margin-top: 1rem;">Theme</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script>
        const state = {
            isLoggedIn: false,
            currentUser: null,
            isSignUp: false,
            defaultCredentials: { email: 'admin@gmail.com', password: '03240324', name: 'Amir' },
            chats: [],
            projects: [],
            uploadedFiles: [],
            currentChatId: null,
            currentPreviewFile: null,
            dialogMode: null
        };

        let landingPage, dashboardPage, authModal, authForm, modalTitle, modalSubtitle, footerText, errorMessage, signUpFields, modalClose, sidebar, hamburger, navMenu;

        function initializeDOM() {
            landingPage = document.getElementById('landingPage');
            dashboardPage = document.getElementById('dashboardPage');
            authModal = document.getElementById('authModal');
            authForm = document.getElementById('authForm');
            modalTitle = document.getElementById('modalTitle');
            modalSubtitle = document.getElementById('modalSubtitle');
            footerText = document.getElementById('footerText');
            errorMessage = document.getElementById('errorMessage');
            signUpFields = document.getElementById('signUpFields');
            modalClose = document.getElementById('modalClose');
            sidebar = document.getElementById('sidebar');
            hamburger = document.getElementById('hamburger');
            navMenu = document.getElementById('navMenu');
        }

        function setupEventListeners() {
            document.getElementById('signInBtn').addEventListener('click', openSignIn);
            document.getElementById('signUpBtn').addEventListener('click', openSignUp);
            document.getElementById('getStartedBtn').addEventListener('click', openSignUp);
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('saveBtn').addEventListener('click', saveSettings);

            authForm.addEventListener('submit', handleAuth);
            hamburger.addEventListener('click', toggleMenu);

            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.dataset.page);
                    sidebar.classList.remove('active');
                });
            });

            document.getElementById('chatSendBtn').addEventListener('click', sendMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            document.getElementById('newChatBtn').addEventListener('click', openNewChatDialog);
            document.getElementById('newProjectBtn').addEventListener('click', openNewProjectDialog);
            document.getElementById('toggleChats').addEventListener('click', toggleChatsList);
            document.getElementById('toggleProjects').addEventListener('click', toggleProjectsList);
            document.getElementById('dialogCancel').addEventListener('click', closeDialog);
            document.getElementById('dialogConfirm').addEventListener('click', confirmDialog);
            document.getElementById('dialogInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') confirmDialog();
            });

            document.getElementById('uploadArea').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });

            document.getElementById('uploadArea').addEventListener('dragover', (e) => {
                e.preventDefault();
                document.getElementById('uploadArea').classList.add('drag-over');
            });

            document.getElementById('uploadArea').addEventListener('dragleave', () => {
                document.getElementById('uploadArea').classList.remove('drag-over');
            });

            document.getElementById('uploadArea').addEventListener('drop', (e) => {
                e.preventDefault();
                document.getElementById('uploadArea').classList.remove('drag-over');
                handleFileUpload(e.dataTransfer.files);
            });

            document.getElementById('fileInput').addEventListener('change', (e) => {
                handleFileUpload(e.target.files);
            });

            document.getElementById('previewCloseBtn').addEventListener('click', closePreview);
            document.getElementById('logoutBtn').addEventListener('click', logout);

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.sidebar') && !e.target.closest('.hamburger')) {
                    sidebar.classList.remove('active');
                    navMenu.classList.remove('active');
                }
            });
        }
        function saveSettings() {
            const name = document.getElementById('settingsName').value.trim();
            const academicStatus = document.getElementById('settingsAcademicStatus').value;
            const department = document.getElementById('settingsDepartment').value.trim();
            const role = document.getElementById('settingsRole').value.trim();
            const phone = document.getElementById('settingsPhone').value.trim();
            const bio = document.getElementById('settingsBio').value.trim();

            if (!name) { alert('Name cannot be empty'); return; }

            // Update state
            state.currentUser.name = name;
            state.currentUser.academicStatus = academicStatus;
            state.currentUser.department = department;
            state.currentUser.role = role;
            state.currentUser.phone = phone;
            state.currentUser.bio = bio;

            // Update UI wherever name is shown
            updateUserDisplay();

            // Persist to localStorage
            localStorage.setItem('currentUser', JSON.stringify(state.currentUser));

            alert('Settings saved successfully ‚úÖ');
        }



        function openSignIn() {
            state.isSignUp = false;
            updateModalUI();
            authModal.classList.add('active');
        }

        function openSignUp() {
            state.isSignUp = true;
            updateModalUI();
            authModal.classList.add('active');
        }

        function toggleAuthMode() {
            state.isSignUp = !state.isSignUp;
            updateModalUI();
        }

        function updateModalUI() {
            if (state.isSignUp) {
                modalTitle.textContent = 'Create account';
                modalSubtitle.textContent = 'Join PHOM and start your research';
                signUpFields.innerHTML = '<div class="form-group"><label for="name">Full name</label><input type="text" id="name" placeholder="Enter your name" required></div>';
                footerText.innerHTML = 'Already have an account? <a id="toggleAuth" style="cursor: pointer;">Sign In</a>';
            } else {
                modalTitle.textContent = 'Sign In';
                modalSubtitle.textContent = 'Welcome back to PHOM';
                signUpFields.innerHTML = '';
                footerText.innerHTML = "Don't have an account? <a id=\"toggleAuth\" style=\"cursor: pointer;\">Sign Up</a>";
            }
            const newToggleLink = document.getElementById('toggleAuth');
            if (newToggleLink) {
                newToggleLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleAuthMode();
                });
            }
        }

        function handleAuth(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = state.isSignUp ? document.getElementById('name').value : null;

            if (state.isSignUp) {
                state.currentUser = { name, email };
                state.isLoggedIn = true;
                closeModal();
                showDashboard();
            } else {
                if (email === state.defaultCredentials.email && password === state.defaultCredentials.password) {
                    state.currentUser = { name: state.defaultCredentials.name, email: state.defaultCredentials.email };
                    state.isLoggedIn = true;
                    closeModal();
                    showDashboard();
                } else {
                    errorMessage.textContent = 'Invalid email or password. Try admin@gmail.com / 03240324';
                    errorMessage.classList.add('show');
                }
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                state.isLoggedIn = false;
                state.currentUser = null;
                landingPage.classList.add('active');
                dashboardPage.classList.remove('active');
            }
        }

        function closeModal() {
            authModal.classList.remove('active');
            authForm.reset();
            errorMessage.classList.remove('show');
        }

        function showDashboard() {
            landingPage.classList.remove('active');
            dashboardPage.classList.add('active');

            // Load saved user if exists
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                state.currentUser = JSON.parse(savedUser);
            }

            updateUserDisplay();
            syncSettingsForm();
        }
        function syncSettingsForm() {
            if (!state.currentUser) return;
            
            document.getElementById('settingsName').value = state.currentUser.name || '';
            document.getElementById('settingsEmail').value = state.currentUser.email || '';
            document.getElementById('settingsAcademicStatus').value = state.currentUser.academicStatus || 'Student';
            document.getElementById('settingsDepartment').value = state.currentUser.department || '';
            document.getElementById('settingsRole').value = state.currentUser.role || '';
            document.getElementById('settingsPhone').value = state.currentUser.phone || '';
            document.getElementById('settingsBio').value = state.currentUser.bio || '';
        }

        state.currentUser = {
            name: 'Amir',
            email: 'admin@gmail.com',
            academicStatus: 'Student',
            department: '',
            role: '',
            phone: '',
            bio: ''
        };



        function updateUserDisplay() {
            if (state.currentUser) {
                document.getElementById('homeGreeting').textContent = `Hello ${state.currentUser.name}`;
                document.getElementById('userNameSidebar').textContent = state.currentUser.name;
                document.getElementById('userEmailSidebar').textContent = state.currentUser.email;
                const initial = state.currentUser.name.charAt(0).toUpperCase();
                document.getElementById('userAvatarSidebar').textContent = initial;
            }
        }

        function toggleMenu() {
            navMenu.classList.toggle('active');
        }

        function navigateTo(page) {
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-page="${page}"]`)?.classList.add('active');

            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            const contentMap = {
                'home': 'homeContent',
                'chatbot': 'chatbotContent',
                'lab': 'labContent',
                'files': 'filesContent',
                'wet-lab': 'wetLabContent',
                'support': 'supportContent',
                'settings': 'settingsContent',
                'design' : 'design',
                'structure-prediction': 'structure-prediction',
                'molecular-docking':'molecular-docking',
                'denovo':'denovo',


            };

            document.getElementById(contentMap[page])?.classList.add('active');
            if (page === 'files') updateFilesList();
            if (page === 'settings') {
                syncSettingsForm();
            }       

        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            addChatMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';

            setTimeout(() => {
                addChatMessage('Great question! I\'m analyzing this for you...', 'ai');
            }, 500);
        }

        function addChatMessage(text, sender) {
            const messagesArea = document.getElementById('chatMessagesArea');
            const wrapper = document.createElement('div');
            wrapper.className = `chat-message-wrapper ${sender}`;
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            messageDiv.textContent = text;
            wrapper.appendChild(messageDiv);
            messagesArea.appendChild(wrapper);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function openNewChatDialog() {
            state.dialogMode = 'chat';
            document.getElementById('dialogTitle').textContent = 'New Chat';
            document.getElementById('dialogSubtitle').textContent = 'What would you like to research?';
            document.getElementById('dialogInput').value = '';
            document.getElementById('dialogInput').focus();
            document.getElementById('dialogOverlay').classList.add('active');
        }

        function openNewProjectDialog() {
            state.dialogMode = 'project';
            document.getElementById('dialogTitle').textContent = 'New Project';
            document.getElementById('dialogSubtitle').textContent = 'Give your project a name';
            document.getElementById('dialogInput').value = '';
            document.getElementById('dialogInput').focus();
            document.getElementById('dialogOverlay').classList.add('active');
        }

        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('active');
            state.dialogMode = null;
        }

        function confirmDialog() {
            const input = document.getElementById('dialogInput').value.trim();
            if (!input) { alert('Please enter a name'); return; }

            if (state.dialogMode === 'chat') {
                const newChat = {
                    id: Date.now(),
                    title: input,
                    date: 'now',
                };
                state.chats.unshift(newChat);
            } else if (state.dialogMode === 'project') {
                const newProject = {
                    id: Date.now(),
                    name: input,
                    files: 0
                };
                state.projects.unshift(newProject);
            }

            closeDialog();
        }

        function toggleChatsList() {
            const items = document.getElementById('chatsList');
            const icon = document.querySelector('#toggleChats .dropdown-icon');
            items.classList.toggle('collapsed');
            icon.classList.toggle('open');
        }

        function toggleProjectsList() {
            const items = document.getElementById('projectsList');
            const icon = document.querySelector('#toggleProjects .dropdown-icon');
            items.classList.toggle('collapsed');
            icon.classList.toggle('open');
        }

        function handleFileUpload(files) {
            Array.from(files).forEach(file => {
                const fileObj = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: formatFileSize(file.size),
                    type: getFileIcon(file.name),
                    extension: file.name.split('.').pop().toLowerCase(),
                    file: file
                };
                state.uploadedFiles.push(fileObj);
            });
            updateFilesList();
        }

        function updateFilesList() {
            const list = document.getElementById('filesList');
            if (state.uploadedFiles.length === 0) {
                list.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 3rem 2rem; color: #999;">üìÅ No files yet. Upload your first file!</div>';
                return;
            }

            list.innerHTML = state.uploadedFiles.map(file => `
                <div style="background: white; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer; border: 1px solid #ddd; transition: all 0.3s;" 
                     onmouseover="this.style.borderColor='${getColorTeal()}'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.1)'; this.style.transform='translateY(-2px)'"
                     onmouseout="this.style.borderColor='#ddd'; this.style.boxShadow='none'; this.style.transform='translateY(0)'"
                     data-file-id="${file.id}">
                    <div style="font-size: 2rem; margin-bottom: 0.8rem;">${file.type}</div>
                    <div style="font-size: 0.85rem; font-weight: 500; color: var(--dark); margin-bottom: 0.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${file.name}</div>
                    <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.8rem;">${file.size}</div>
                    <div style="display: flex; gap: 0.4rem; justify-content: center;">
                        <button onclick="openFilePreview(${file.id})" style="background: #f5f5f5; border: none; cursor: pointer; font-size: 0.9rem; color: #666; padding: 0.4rem 0.8rem; border-radius: 4px; transition: all 0.2s; flex: 1;" onmouseover="this.style.background='${getColorTeal()}'; this.style.color='white'" onmouseout="this.style.background='#f5f5f5'; this.style.color='#666'"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg></button>
                        <button onclick="deleteFile(${file.id})" style="background: #f5f5f5; border: none; cursor: pointer; font-size: 0.9rem; color: #666; padding: 0.4rem 0.8rem; border-radius: 4px; transition: all 0.2s; flex: 1;" onmouseover="this.style.background='${getColorTeal()}'; this.style.color='white'" onmouseout="this.style.background='#f5f5f5'; this.style.color='#666'">X</button>
                    </div>
                </div>
            `).join('');
        }

        function openFilePreview(fileId) {
            const file = state.uploadedFiles.find(f => f.id === fileId);
            if (!file) return;

            state.currentPreviewFile = file;
            const rightside = document.getElementById('filesRightSide');
            const leftside = document.getElementById('filesLeftSide');
            const previewContent = document.getElementById('previewContent');
            const previewTitle = document.getElementById('previewTitle');

            previewTitle.textContent = file.name;
            previewContent.innerHTML = '';

            if (file.extension === 'pdf') {
                renderPdfPreview(file, previewContent);

            } else if (['png', 'jpg', 'jpeg', 'gif'].includes(file.extension)) {
                previewContent.innerHTML = `
                    <img src="${URL.createObjectURL(file.file)}" class="preview-image" alt="${file.name}">
                    <div class="preview-info">
                        <div class="preview-info-item">
                            <span class="preview-info-label">File Name:</span>
                            <span class="preview-info-value">${file.name}</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">File Size:</span>
                            <span class="preview-info-value">${file.size}</span>
                        </div>
                    </div>
                `;
            } else if (['txt', 'md', 'json', 'csv', 'xml', 'html', 'css', 'js', 'log'].includes(file.extension)) {
                renderTextPreview(file, previewContent);
            }else {
                previewContent.innerHTML = `
                    <div class="preview-info">
                        <div class="preview-info-item">
                            <span class="preview-info-label">File Name:</span>
                            <span class="preview-info-value">${file.name}</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">File Size:</span>
                            <span class="preview-info-value">${file.size}</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">File Type:</span>
                            <span class="preview-info-value">${file.extension.toUpperCase()}</span>
                        </div>
                        <p style="margin-top: 1rem; color: #999; font-size: 0.9rem;">Preview not available for this file type</p>
                    </div>
                `;
            }

            rightside.classList.add('preview-active');
            leftside.classList.add('preview-active');
        }
        function renderTextPreview(file, container) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                const preview = document.createElement('div');
                preview.style.cssText = `
                    background: #f5f5f5;
                    padding: 1rem;
                    border-radius: 8px;
                    font-family: 'Courier New', monospace;
                    font-size: 0.85rem;
                    line-height: 1.6;
                    white-space: pre-wrap;
                    word-wrap: break-word;
                    color: var(--dark);
                    max-height: 400px;
                    overflow-y: auto;
                    border: 1px solid #ddd;
                `;
                preview.textContent = content.substring(0, 5000); // Limit to first 5000 chars
                
                if (content.length > 5000) {
                    const note = document.createElement('p');
                    note.textContent = `... (showing first 5000 characters of ${content.length})`;
                    note.style.cssText = 'color: #999; font-size: 0.8rem; margin-top: 0.5rem; font-style: italic;';
                    container.appendChild(preview);
                    container.appendChild(note);
                } else {
                    container.appendChild(preview);
                }

                const info = document.createElement('div');
                info.className = 'preview-info';
                info.style.marginTop = '1rem';
                info.innerHTML = `
                    <div class="preview-info-item">
                        <span class="preview-info-label">File Name:</span>
                        <span class="preview-info-value">${file.name}</span>
                    </div>
                    <div class="preview-info-item">
                        <span class="preview-info-label">File Size:</span>
                        <span class="preview-info-value">${file.size}</span>
                    </div>
                    <div class="preview-info-item">
                        <span class="preview-info-label">File Type:</span>
                        <span class="preview-info-value">${file.extension.toUpperCase()}</span>
                    </div>
                `;
                container.appendChild(info);
            };
            reader.readAsText(file.file);
        }
        function renderPdfPreview(file, container) {
            container.innerHTML = '';

            const wrapper = document.createElement('div');
            wrapper.className = 'pdf-scroll-wrapper';
            container.appendChild(wrapper);

            const fileURL = URL.createObjectURL(file.file);

            pdfjsLib.getDocument(fileURL).promise.then(pdf => {
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    pdf.getPage(pageNum).then(page => {
                        const canvas = document.createElement('canvas');
                        canvas.className = 'pdf-page-canvas';
                        wrapper.appendChild(canvas);

                        const ctx = canvas.getContext('2d');

                        const containerWidth = wrapper.clientWidth - 16;
                        const baseViewport = page.getViewport({ scale: 1 });
                        const scale = containerWidth / baseViewport.width;
                        const viewport = page.getViewport({ scale });

                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        page.render({
                            canvasContext: ctx,
                            viewport
                        });
                    });
                }
            });
        }


        function closePreview() {
            const rightside = document.getElementById('filesRightSide');
            const leftside = document.getElementById('filesLeftSide');
            rightside.classList.remove('preview-active');
            leftside.classList.remove('preview-active');
            state.currentPreviewFile = null;
        }

        function deleteFile(fileId) {
            if (state.currentPreviewFile?.id === fileId) {
                closePreview();
            }
            state.uploadedFiles = state.uploadedFiles.filter(f => f.id !== fileId);
            updateFilesList();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const icons = {'pdf': 'üìÑ', 'doc': 'üìù', 'docx': 'üìù', 'xls': 'üìä', 'xlsx': 'üìä', 'csv': 'üìä', 'txt': 'üìÑ', 'png': 'üñºÔ∏è', 'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'gif': 'üñºÔ∏è', 'ppt': 'üìΩÔ∏è', 'pptx': 'üìΩÔ∏è', 'zip': 'üóÇÔ∏è'};
            return icons[ext] || 'üìé';
        }

        function getColorTeal() {
            return '#1a8b7f';
        }

        function init() {
            initializeDOM();
            setupEventListeners();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.sidebar-header');
            const subItems = document.querySelectorAll('.submenu-item');
            const arrow = header.querySelector('.dropdown-arrow');

            // Initially hide sub-items (or show them based on your preference)
            subItems.forEach(item => {
                item.style.display = 'none'; // Start collapsed
            });

            header.addEventListener('click', function() {
                const isExpanded = arrow.textContent === '‚ñ≤'; // Check current state

                subItems.forEach(item => {
                    item.style.display = isExpanded ? 'none' : 'block';
                });

                // Toggle arrow direction
                arrow.textContent = isExpanded ? '‚ñº' : '‚ñ≤';
            });
        });
    </script>
</body>
</html>